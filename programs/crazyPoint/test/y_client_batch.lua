package.cpath = "../../open/lib/?.so;" .. package.cpath
local socket = require('socket')

local host = "127.0.0.1"
local port = 3333
local serv = "crazypoint"

local function http(cfg, data)
	local tcp = socket.tcp()
	if tcp == nil then
		error('load tcp failed')
		return false
	end
	tcp:settimeout(10000)
	local ret = tcp:connect(cfg["host"], cfg["port"])
	if ret == nil then
		error("connect failed!")
		return false
	end

	tcp:send(data)
	local result = tcp:receive("*a")
	tcp:close()
	return result
end

local function get_data( body )
	return "POST /crazypointApply.json HTTP/1.0\r\n" ..
	"User-Agent: curl/7.33.0\r\n" ..
	string.format("Host: %s:%d\r\n", host, port) ..
	"Content-Type: application/json; charset=utf-8\r\n" ..
	--"Content-Type: application/x-www-form-urlencoded\r\n" ..
	"Connection: close\r\n" ..
	"Content-Length:" .. #body .. "\r\n" ..
	"Accept: */*\r\n\r\n" ..
	body
end


local body = {
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":"kkoo","TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60) %(60 *60 *24)),
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"accountID":"kxl1QuHKCD", "tokenCode":"czlhlRzmaA"},"TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60) %(60 *60 *24)),
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"accountID":"kxl1QuHKCD"},"TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60) %(60 *60 *24)),
	string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"tokenCode":"lN6GQBBCo5","imei":"800981013883924","startTime":"1404367200","endTime":"1404370800"},"TIME":%d,"LIVE":1}',
	(os.time()+ 8*60*60 ) %(60 *60 *24)),
}

--[[
for idx,val in pairs(body) do
--print(idx,val)
local data = get_data(val)
print(data)
local info = http({host = host, port = port}, data)
print(info)
end
--]]

body = {
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":"kkoo","TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60) %(60 *60 *24)),
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"accountID":"kxl1QuHKCD", "tokenCode":"czlhlRzmaA"},"TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60) %(60 *60 *24)),
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"accountID":"kxl1QuHKCD"},"TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60) %(60 *60 *24)),
	--string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"tokenCode":"lN6GQBBCo5","imei":"800981013883924","startTime":"1404367200","endTime":"1404370800"},"TIME":%d,"LIVE":1}',
	--(os.time()+ 8*60*60 + 180) %(60 *60 *24)),

	string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"tokenCode":"HnHpllpimZ","imei":"860122717752589","startTime":"1413784067","endTime":"1414025017"},"TIME":%d,"LIVE":1}',
	(os.time()+ 8*60*60 + 30) %(60 *60 *24)),
}
--[[
]]--
function handle()
	--for i = 0, 10000 do
	for i = 0, 100 do
		for idx,val in pairs(body) do
			--print(idx,val)
			local data = get_data(val)
			print(data)
			local info = http({host = host, port = port}, data)
			print(info)
		end
	end
end

function handle_single(imei, startTime,endTime,tokenCode)
	local val =  string.format('{"APPLY":"gopath","MODE":"insert","EXEC":"make","ARGS":{"tokenCode":"%s","imei":"%s","startTime":"%s","endTime":"%s"},"TIME":%d,"LIVE":1}', tokenCode, imei, startTime,endTime,(os.time()+ 8*60*60 + 30) %(60 *60 *24))
	local data = get_data(val)
	print(data)
	local info = http({host = host, port = port}, data)
	print(info)
end

local tb_index = {
	["imei"]              = 1,
	["startTime"]         = 2,
	["endTime"]           = 3,
	["onlineTime"]        = 4,
	["createTime"]        = 5,
	["tokenCode"]         = 6,
}

local tb = {
	{'313992692168289',	1414413029,	1414575324,	162295,	1414575324,'luJqn7SFAd'},	
	{'584140660481803',	1414451574,	1414571781,	120207,	1414571781,'zzq5qDl8mw'},	
	{'368886986203261',	1414478824,	1414572845,	94021,	1414572845,'7wlcAllsvL'},	
	{'643456817618678',	1414484824,	1414578601,	93777,	1414578601,'5SiilmtuJV'},	
	{'324208755146642',	1414485304,	1414574403,	89099,	1414574403,'X6vRhAlmfu'},	
	{'300861368713295',	1414489542,	1414572846,	83304,	1414572846,'8I0qllmGcz'},	
	{'142732464892576',	1414489689,	1414574061,	84372,	1414574061,'klHlMlwsa0'},	
	{'234594343325775',	1414490106,	1414573248,	83142,	1414573248,'wD2sdvultk'},	
	{'379171835909252',	1414527965,	1414572000,	44035,	1414572000,'kKNlGllO0p'},	
	{'762691088959907',	1414528235,	1414576804,	48569,	1414576804,'dT5kaolAlW'},	
	{'546033475618577',	1414531215,	1414577373,	46158,	1414577373,'uQM00csbhb'},	
	{'651361954526859',	1414531325,	1414571597,	40272,	1414571638,'unRzlxSMyi'},	
	{'392227436589951',	1414531348,	1414570596,	39248,	1414570596,'kmxZaaG6cn'},	
	{'157908605434393',	1414531782,	1414572832,	41050,	1414572832,'lqimDzk6as'},	
	{'460450430260562',	1414531794,	1414570177,	38383,	1414570177,'CBy2YnjLXF'},	
	{'856204626455391',	1414531796,	1414571799,	40003,	1414571799,'IV6lrvXisl'},	
	{'994441611389002',	1414532624,	1414574031,	41407,	1414574031,'cClmkJmhJm'},	
	{'314333312315381',	1414532715,	1414574403,	41688,	1414574403,'qQKAVmqcls'},	
	{'341745882336512',	1414532906,	1414572845,	39939,	1414572845,'4C06c75554'},	
	{'359078398330061',	1414533026,	1414577389,	44363,	1414577389,'Mqo05mAl70'},	
	{'565124241892111',	1414533108,	1414570201,	37093,	1414570201,'uosuOkvWla'},	
	{'198696549459748',	1414533206,	1414572678,	39472,	1414572678,'NBxzrzRYSm'},	
	{'827938604802738',	1414533467,	1414573588,	40121,	1414573588,'klAlz7xtlu'},	
	{'342035998338472',	1414533485,	1414573933,	40448,	1414573933,'a0zmS8YUWO'},	
	{'536397849840262',	1414533557,	1414572821,	39264,	1414572821,'lTYDHsIGTl'},	
	{'550903099962739',	1414533858,	1414576827,	42969,	1414576827,'3moGalz2uy'},	
	{'621186993894837',	1414533892,	1414575594,	41702,	1414575594,'5h121vlzsm'},	
	{'242840957305292',	1414534028,	1414570080,	36052,	1414570080,'HElfplT5lq'},	
	{'610159941159580',	1414534075,	1414577402,	43327,	1414577402,'OBlAThasyl'},	
	{'617340336804922',	1414534513,	1414574199,	39686,	1414574199,'RW4jlxGD5S'},	
	{'655868930046287',	1414534562,	1414572560,	37998,	1414572560,'AB4maMT6sm'},	
	{'937696509865435',	1414534625,	1414572302,	37677,	1414572302,'Ol7m3ONYTe'},	
	{'476805972307067',	1414534919,	1414570970,	36051,	1414570970,'GqWl7ziZqq'},	
	{'914909459523194',	1414534947,	1414573200,	38253,	1414573200,'s6Jlrwm7ls'},	
	{'784442566067407',	1414535022,	1414571742,	36720,	1414571742,'mF9cYDnDK0'},	
	{'979415156734912',	1414535093,	1414575423,	40330,	1414575423,'3V0lzlml9u'},	
	{'699897619522555',	1414535627,	1414572903,	37276,	1414572903,'lsClTrvosl'},	
	{'911314798734557',	1414535711,	1414571221,	35510,	1414571221,'wwrowmglTl'},	
	{'669207359071696',	1414535731,	1414578043,	42312,	1414578043,'MqaljVLkv0'},	
	{'980903825362550',	1414535904,	1414573890,	37986,	1414573890,'blJvT767Vf'},	
	{'237791336138119',	1414535929,	1414571201,	35272,	1414571201,'pDEv3uMkjQ'},	
	{'546217346532667',	1414535988,	1414569788,	33800,	1414569788,'4QAMllh5lJ'},	
	{'189791275007620',	1414535990,	1414578629,	42639,	1414578629,'iaAGETA0vf'},	
	{'315167955383838',	1414536117,	1414574922,	38805,	1414574922,'bb0sBtVlAD'},	
	{'505856100388664',	1414536195,	1414570790,	34595,	1414570790,'6TlzavdOlk'},	
	{'668171127973016',	1414536289,	1414570851,	34562,	1414570851,'UlqlTQslll'},	
	{'598099090000308',	1414536306,	1414571138,	34832,	1414571138,'66S0IlpLts'},	
	{'420497876671843',	1414536503,	1414572459,	35956,	1414572459,'kXuNkUpzyx'},	
	{'867478542024013',	1414536577,	1414575629,	39052,	1414575629,'P5zmYDi11l'},	
	{'124985320468013',	1414536610,	1414573863,	37253,	1414573863,'cWSeThBblC'},	
	{'143051614382811',	1414536668,	1414569666,	32998,	1414569666,'Hc6yl8lvHa'},	
	{'239766014771538',	1414536736,	1414574732,	37996,	1414574732,'WhjsPOmHQe'},	
	{'249152767776057',	1414537007,	1414575402,	38395,	1414575402,'mYevFbW1rl'},	
	{'564353664032944',	1414537127,	1414572000,	34873,	1414572000,'loTqbRYUfk'},	
	{'531712025897297',	1414537308,	1414575060,	37752,	1414575060,'blQ0p0Ylzs'},	
	{'197309984239812',	1414537339,	1414571551,	34212,	1414571551,'Qkmur3CHiu'},	
	{'604405905164167',	1414537412,	1414570007,	32595,	1414570007,'qrllDw4AGw'},	
	{'713850447068293',	1414537453,	1414573101,	35648,	1414573148,'QKDPImtlo0'},	
	{'681972488788866',	1414537464,	1414570632,	33168,	1414570632,'ksivmLv3am'},	
	{'137739771565636',	1414537532,	1414574567,	37035,	1414574567,'FJrlpc4DpM'},	
	{'968348485046588',	1414537612,	1414577101,	39489,	1414577101,'hm337luq0A'},	
	{'180693345649770',	1414537613,	1414578052,	40439,	1414578052,'Tkl8zv7cql'},	
	{'284440330334306',	1414537933,	1414571702,	33769,	1414571702,'3obpHCcep0'},	
	{'592848748588304',	1414538038,	1414576503,	38465,	1414576503,'slspsNzlOG'},	
	{'566226157816619',	1414538101,	1414577100,	38999,	1414577100,'ozcspGQG7Y'},	
	{'111497801658182',	1414538149,	1414576660,	38511,	1414576660,'m0ssvehmzA'},	
	{'903302783942756',	1414538160,	1414574752,	36592,	1414574752,'940muylWDJ'},	
	{'269514309517759',	1414538161,	1414570241,	32080,	1414570287,'KwlvoH9AQm'},	
	{'828383755376647',	1414538276,	1414570506,	32230,	1414571366,'Zwuvlw6AWv'},	
	{'624345522638357',	1414538343,	1414572967,	34624,	1414572967,'qGslHM1lgh'},	
	{'932292979462138',	1414538461,	1414571402,	32941,	1414571402,'kIlpb2Jxlq'},	
	{'874317618857750',	1414538491,	1414572491,	34000,	1414572491,'llkwaGru7f'},	
	{'279002787380369',	1414538550,	1414575834,	37284,	1414575834,'86lbHVQWSo'},	
	{'470265680110079',	1414538618,	1414577365,	38747,	1414577906,'wpXJ6lglDw'},	
	{'289457858572864',	1414538711,	1414577625,	38914,	1414577625,'ovznpz6nRs'},	
	{'301877479402809',	1414538920,	1414576563,	37643,	1414576985,'eDkVPPK2C2'},	
	{'287516667071905',	1414539377,	1414574114,	34737,	1414574114,'iG0zklS4qh'},	
	{'339649701358661',	1414539390,	1414577101,	37711,	1414577101,'nm1omSfHvm'},	
	{'515792792331803',	1414539668,	1414574514,	34846,	1414574514,'ezJllj7lZZ'},	
	{'923242380964371',	1414539755,	1414578387,	38632,	1414578387,'l0iNe3iT7s'},	
	{'545314891537844',	1414539853,	1414571938,	32085,	1414571938,'lQAPbmlpkK'},	
	{'547545792217162',	1414540113,	1414572565,	32452,	1414572565,'NlqlczJQAK'},	
	{'266473776926071',	1414540287,	1414577147,	36860,	1414577147,'FOj3zklzqk'},	
	{'286417485513692',	1414540599,	1414574402,	33803,	1414574402,'qM3yavXnSz'},	
	{'840552691221141',	1414540606,	1414575227,	34621,	1414575227,'ECSWDmQodp'},	
	{'560766917595900',	1414540941,	1414570205,	29264,	1414570205,'xc0olp6r7r'},	
	{'243664586805475',	1414541021,	1414574770,	33749,	1414574770,'rQQuAlShXj'},	
	{'525505824270239',	1414541086,	1414576462,	35376,	1414576462,'hK7wbolj4C'},	
	{'718660381936024',	1414541106,	1414572264,	31158,	1414572264,'ljue8lqQll'},	
	{'595723380484269',	1414541115,	1414570096,	28981,	1414570304,'QlYlC3GCpw'},	
	{'133786059500490',	1414541158,	1414570635,	29477,	1414570635,'kyMStizcLl'},	
	{'555326171747890',	1414541457,	1414572847,	31390,	1414572847,'llqllzy9HH'},	
	{'903705063764221',	1414541534,	1414571246,	29712,	1414572451,'kqGsMivlkw'},	
	{'777521712940762',	1414541540,	1414570596,	29056,	1414570596,'xsz3H08XRi'},	
	{'928836532459969',	1414541623,	1414576422,	34799,	1414576422,'TEFzXquXq8'},	
	{'222656854246643',	1414541962,	1414572409,	30447,	1414572409,'wn8rlOcmlQ'},	
	{'838055980105698',	1414542009,	1414571090,	29081,	1414571090,'HmyTpQmSpi'},	
	{'985832002898851',	1414542548,	1414572603,	30055,	1414572933,'lcNv0Aluqz'},	
	{'869654552644209',	1414542689,	1414576223,	33534,	1414576223,'wqX6lsCQCq'},	
	{'149422989264906',	1414542700,	1414574672,	31972,	1414574672,'8P4DnlwCXN'},	
	{'515786994308346',	1414542827,	1414575273,	32446,	1414575273,'bkqfPkie2A'},	
	{'350239384322798',	1414543050,	1414576428,	33378,	1414576428,'PJQJDkHllI'},	
	{'144333612333759',	1414543242,	1414571529,	28287,	1414571529,'plmv7vzYwq'},	
	{'835737725624975',	1414543317,	1414577181,	33864,	1414577181,'8ilMMlgbHD'},	
	{'409740649211941',	1414543690,	1414576495,	32805,	1414576495,'EqTml7yLn6'},	
	{'782766525962023',	1414543712,	1414572168,	28456,	1414572168,'DTkBJ8lHlG'},	
	{'176933021446034',	1414544265,	1414575087,	30822,	1414575087,'Ql5mvwlrMk'},	
	{'119498480731276',	1414544530,	1414575402,	30872,	1414575402,'4Mdv0bHTla'},	
	{'743774972980652',	1414544786,	1414576525,	31739,	1414576525,'qsl4imPoV2'},	
	{'735002196266884',	1414544867,	1414575166,	30299,	1414575166,'lnZ9uA0qyz'},	
	{'445497370349319',	1414545097,	1414578002,	32905,	1414578002,'JSI5n5PEAR'},	
	{'423655169235389',	1414545156,	1414575586,	30430,	1414575586,'ILGluQagjc'},	
	{'464024043806214',	1414545163,	1414571103,	25940,	1414571103,'uv61SZ1CpQ'},	
	{'696001644372465',	1414545213,	1414577687,	32474,	1414577687,'Rsl9KKljPs'},	
	{'412070662956122',	1414545711,	1414571620,	25909,	1414571620,'GDJaRARQDQ'},	
	{'469766719997413',	1414546154,	1414575502,	29348,	1414575502,'l34EWmdl6W'},	
	{'172167816521834',	1414546282,	1414571566,	25284,	1414571566,'klpuTalMaC'},	
	{'398447870090159',	1414546464,	1414577492,	31028,	1414577492,'EollAw6ylw'},	
	{'574632889080632',	1414546744,	1414569927,	23183,	1414569927,'jQlNF3GLTs'},	
	{'395638048221345',	1414547152,	1414577865,	30713,	1414577865,'fciSlh8QlI'},	
	{'456373931788525',	1414547507,	1414576255,	28748,	1414576255,'lMloCoyGcl'},	
	{'664731108298016',	1414547640,	1414572650,	25010,	1414572650,'nFp0QuuMn7'},	
	{'365533194358106',	1414548262,	1414571043,	22781,	1414571069,'HQ3E7AckkD'},	
	{'621126836356339',	1414548303,	1414577808,	29505,	1414578243,'CQslXwzll0'},	
	{'725729712517190',	1414548891,	1414575783,	26892,	1414575783,'OupovlaqGk'},	
	{'764049441564732',	1414549266,	1414578437,	29171,	1414578437,'8M3mbBaclm'},	
	{'711555110572784',	1414549395,	1414571186,	21791,	1414571186,'7Mclshs0Os'},	
	{'200652973053131',	1414549766,	1414574333,	24567,	1414574333,'9mMxakLUgf'},	
	{'237634274903898',	1414549887,	1414576713,	26826,	1414576713,'hQ2f7aTqll'},	
	{'955874264778609',	1414549952,	1414572238,	22286,	1414572238,'kmjsvWvzSZ'},	
	{'739699603952620',	1414550001,	1414571794,	21793,	1414571794,'6jCimri4xW'},	
	{'294717328397017',	1414550569,	1414573171,	22602,	1414573266,'mSlQvllzQv'},	
	{'776846753385689',	1414550739,	1414572331,	21592,	1414572331,'XPl7lsUPul'},	
	{'541678040901349',	1414550761,	1414577044,	26283,	1414577044,'aYIlmBkuhk'},	
	{'500226414749867',	1414550890,	1414572387,	21497,	1414572387,'zm9phEblyu'},	
	{'270684855664714',	1414551459,	1414572861,	21402,	1414572861,'ZSMU0BUdYh'},	
	{'269529921488171',	1414551779,	1414572028,	20249,	1414572028,'Mymuxmll6x'},	
	{'593704825643950',	1414551811,	1414575813,	24002,	1414575813,'lvAm8yYs3Q'},	
	{'572137368696546',	1414551909,	1414575805,	23896,	1414575805,'FwlRcxwjaY'},	
	{'985712419569255',	1414552125,	1414572848,	20723,	1414572848,'6lJvUHcsMj'},	
	{'851063121757999',	1414552393,	1414573380,	20987,	1414573380,'fz9D4vlqnT'},	
	{'386167216232042',	1414552488,	1414577773,	25285,	1414577773,'1J0vlTsRqm'},	
	{'106986448299308',	1414552526,	1414573707,	21181,	1414573707,'tlzQYlmf1w'},	
	{'695657353657072',	1414552635,	1414574585,	21950,	1414574585,'BQGJUEzcEA'},	
	{'874726960573783',	1414552658,	1414574990,	22332,	1414574990,'1c2FnwJTzi'},	
	{'170795198731464',	1414552734,	1414573550,	20816,	1414573550,'HolunluIvc'},	
	{'768960161099517',	1414552778,	1414576386,	23608,	1414576386,'mrpmmITsmt'},	
	{'814865411702576',	1414553131,	1414574788,	21657,	1414574788,'Talibsvm0y'},	
	{'509034103784364',	1414553296,	1414576797,	23501,	1414576797,'l48xyNkmnp'},	
	{'729684560125057',	1414553397,	1414575355,	21958,	1414575355,'EMYHlrMsPc'},	
	{'263246837170811',	1414553636,	1414575950,	22314,	1414575950,'llfls7sv0y'},	
	{'732985976567369',	1414553731,	1414578301,	24570,	1414578301,'ss0zesgqlW'},	
	{'143633450540139',	1414553805,	1414577052,	23247,	1414577052,'EHlVbm7sqS'},	
	{'712228481489025',	1414553921,	1414576923,	23002,	1414576923,'MHQOlAMlJJ'},	
	{'357936569478054',	1414554258,	1414577577,	23319,	1414577577,'Ao8aA36cll'},	
	{'479477606765933',	1414554267,	1414577305,	23038,	1414577305,'oxnNTSzFOo'},	
	{'744303303141849',	1414554370,	1414574742,	20372,	1414574742,'WallHCdQBl'},	
	{'541316961106032',	1414554544,	1414576637,	22093,	1414576637,'RElMcJwfwl'},	
	{'866384525827813',	1414554736,	1414577370,	22634,	1414577370,'lT4v0mxp5g'},	
	{'234731185031216',	1414554844,	1414577050,	22206,	1414577050,'1llTl0lZol'},	
	{'692843553676715',	1414554889,	1414576870,	21981,	1414576870,'lvTjcyv0sl'},	
	{'828125599948317',	1414554949,	1414576655,	21706,	1414576655,'Xl2MlZlzJz'},	
	{'798669240712487',	1414554966,	1414575864,	20898,	1414575864,'azjlbkyT1l'},	
	{'175261310535213',	1414555108,	1414577979,	22871,	1414577979,'bqlsmmGpql'},	
	{'252048664243593',	1414555096,	1414577708,	22612,	1414577708,'yEoQWlr4jm'},	
	{'147547151857111',	1414555517,	1414576709,	21192,	1414576709,'llclusj0O0'},	
	{'165928567839157',	1414555538,	1414577585,	22047,	1414577585,'0lq6Tlzygz'},	
	{'460768313247913',	1414555672,	1414577908,	22236,	1414577908,'asad8ObQwK'},	
	{'596044719727552',	1414555685,	1414576533,	20848,	1414576533,'llnhzlklmm'},	
	{'709269742290310',	1414556035,	1414577402,	21367,	1414577402,'WmlwZGllzl'},	
	{'362456533875601',	1414556457,	1414577453,	20996,	1414577453,'lLKGG4vxR9'},	
	{'559808121797659',	1414557349,	1414578217,	20868,	1414578217,'ypszl68lzl'},	
	{'297738882155838',	1414557669,	1414578504,	20835,	1414578504,'5qkelGMlzo'},	
	{'806547971728171',	1414558354,	1414578459,	20105,	1414578459,'Ymsl1vsSLz'},	
}

for i,v in pairs(tb) do
	local imei = v[tb_index["imei"]]
	local startTime = v[tb_index["startTime"]]
	local endTime = v[tb_index["endTime"]]
	local tokenCode = v[tb_index["tokenCode"]]
	--print(imei,startTime,endTime, tokenCode)
	handle_single(imei,startTime, endTime,tokenCode)
end
--handle()
